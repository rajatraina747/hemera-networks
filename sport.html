<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Hemera Networks – Sport</title>

  <!-- ── Inject shared head bits (favicon, CSS links, etc.) ── -->
  <script>
    fetch('/head.html')
      .then(r => r.text())
      .then(fragment => {
        // This fragment typically includes your <link rel="icon">, <link rel="stylesheet">, etc.
        document.head.insertAdjacentHTML('beforeend', fragment);
      })
      .catch(console.error);
  </script>

  <!-- 
    ── Sport-page-only CSS overrides: 
       1) Display each sub-category’s cards in a single flex row with horizontal scrolling
       2) Force each “news-card” to a fixed width so they don’t wrap onto multiple lines
       3) Add a thin custom scrollbar (WebKit browsers only)
       4) Shrink each card on tablets/phones for responsiveness
  -->
  <style>
    /* 1) Make each sub-section’s container a flex row that scrolls horizontally */
    #sport-subsections .sport-section .sport-grid {
      display: flex !important;
      flex-wrap: nowrap !important;
      overflow-x: auto !important;
      gap: 1rem !important;
      margin-bottom: 3rem !important;
      padding-bottom: 0.5rem; /* leave a little room for the scrollbar */
    }

    /* 2) Give each cloned “news-card” a fixed width so items never wrap */
    #sport-subsections .sport-section .sport-grid > * {
      flex: 0 0 250px;
    }

    /* 3) Custom horizontal scrollbar styling (WebKit-only) */
    #sport-subsections .sport-section .sport-grid::-webkit-scrollbar {
      height: 8px;
    }
    #sport-subsections .sport-section .sport-grid::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }
    #sport-subsections .sport-section .sport-grid::-webkit-scrollbar-track {
      background: transparent;
    }

    /* 4) Narrower card widths on smaller screens */
    @media (max-width: 768px) {
      #sport-subsections .sport-section .sport-grid > * {
        flex: 0 0 200px;
      }
    }
    @media (max-width: 480px) {
      #sport-subsections .sport-section .sport-grid > * {
        flex: 0 0 150px;
      }
    }
  </style>
</head>
<body>
  <!-- These two divs are populated by script.js (header & footer injection) -->
  <div id="header-container"></div>

  <main class="main-content">
    <h2 class="section-title">Sport</h2>

    <!-- This is where we will inject one <section> per sub-category -->
    <div id="sport-subsections"></div>
  </main>

  <div id="footer-container"></div>

  <!-- Core site script: inserts header & footer, handles weather map, mobile menu, etc. -->
  <script src="/script.js" defer></script>

  <!-- 
    Inline script to build each sports sub-section dynamically. 
    Steps:
      1) Fetch /news.html  
      2) Find all <div class="news-card"> elements that have <span class="category-sports">  
      3) For each such “news-card,” fetch its article page and extract <a class="category-tag">…</a>  
      4) Bucket news-cards by those article-level tags (or “Other” if none)  
      5) Sort buckets by descending size and render each as a single flex-row scroll container 
  -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // 1) Fetch news.html
      let newsText;
      try {
        const resp = await fetch('/news.html');
        newsText = await resp.text();
      } catch (err) {
        console.error('Error fetching news.html:', err);
        return;
      }

      // 2) Parse news.html into a DOM
      const parser = new DOMParser();
      const newsDoc = parser.parseFromString(newsText, 'text/html');

      // 3) Grab all <div class="news-card"> that contain <span class="category-sports">
      const allNewsCards = Array.from(newsDoc.querySelectorAll('.news-card'));
      const sportCards = allNewsCards.filter(card =>
        card.querySelector('span.category-sports')
      );
      // If no <span.category-sports> is found, sportCards = []

      // 4) Prepare a “buckets” object: { "Football": [card1,card2], "Cricket": [card3], …, "Other": [cardX] }
      const buckets = {};

      // 5) For each sports-related card, fetch its linked article page and read <a class="category-tag">
      const tasks = sportCards.map(async card => {
        // Each “news-card” contains <div class="news-details"> 
        // with an <a href="…"><h3>…</h3></a> inside it.
        const linkEl = card.querySelector('.news-details a');
        if (!linkEl) {
          // If no link, slot into “Other”
          return { card, tags: [] };
        }
        const articleHref = linkEl.getAttribute('href');
        const articleURL = new URL(articleHref, window.location.origin).href;

        try {
          const artResp = await fetch(articleURL);
          const artText = await artResp.text();
          const artDoc = parser.parseFromString(artText, 'text/html');
          // Extract any <a class="category-tag">…</a> inside the article
          const tagEls = artDoc.querySelectorAll('a.category-tag');
          const tags = Array.from(tagEls).map(el => el.textContent.trim());
          return { card, tags };
        } catch (err) {
          console.error(`Error fetching/parsing ${articleURL}:`, err);
          return { card, tags: [] };
        }
      });

      // 6) Wait for all fetch+parse operations to finish
      const results = await Promise.all(tasks);

      // 7) Populate buckets
      results.forEach(({ card, tags }) => {
        if (tags.length > 0) {
          // If the article had one or more <a.category-tag>, bucket under each tag
          tags.forEach(tagName => {
            if (!buckets[tagName]) buckets[tagName] = [];
            buckets[tagName].push(card);
          });
        } else {
          // No <a.category-tag> → “Other”
          if (!buckets['Other']) buckets['Other'] = [];
          buckets['Other'].push(card);
        }
      });

      // 8) Reference the container where we’ll place each sub-section
      const container = document.getElementById('sport-subsections');

      // 9) Sort buckets by descending article count, then build each <section>
      Object.entries(buckets)
        .sort((a, b) => b[1].length - a[1].length)
        .forEach(([subcatName, cardList]) => {
          // a) Create <section class="sport-section">
          const section = document.createElement('section');
          section.classList.add('sport-section');

          // b) Build a heading <h3> like “Football (3)”
          const heading = document.createElement('h3');
          heading.textContent = `${subcatName} (${cardList.length})`;
          heading.style.marginTop = '2rem';
          heading.style.marginBottom = '1rem';
          heading.style.color = 'var(--black)';
          heading.style.fontSize = '1.5rem';
          heading.style.borderLeft = '6px solid var(--gold)';
          heading.style.paddingLeft = '1rem';
          section.appendChild(heading);

          // c) Create a flex container <div class="sport-grid">
          //    All cloned cards will go here in a single horizontal row
          const grid = document.createElement('div');
          grid.classList.add('sport-grid');

          // d) Clone each matching “news-card” into that flex container
          cardList.forEach(origCard => {
            const clone = origCard.cloneNode(true);
            grid.appendChild(clone);
          });

          section.appendChild(grid);
          container.appendChild(section);
        });
    });
  </script>
</body>
</html>
