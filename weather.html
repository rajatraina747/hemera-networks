<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Global Weather Map</title>

  <!-- Leaflet core CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

  <!-- Your main stylesheet -->
  <link rel="stylesheet" href="/assets/css/style.css" />

  <style>
    /* Make the map fill most of the viewport, with a solid fallback background */
    #weather-map {
      width: 100%;
      height: 80vh;
      min-height: 400px;
      margin: 1rem auto;
      background: #ddd;
      border: 2px solid var(--gold);
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="header-container"></div>

  <main class="main-content">
    <h2 class="section-title">Global Weather Map</h2>
    <div id="weather-map"></div>
  </main>

  <div id="footer-container"></div>

  <!-- Leaflet & MarkerCluster -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <!-- your loader (defines loadHTML & window.WEATHER_API_KEY) -->
  <script src="/script.js" defer></script> :contentReference[oaicite:0]{index=0}&#8203;:contentReference[oaicite:1]{index=1}

  <!-- …same header/footer injection and base-layer setup… -->

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    await loadHTML('header-container','/header.html');
    await loadHTML('footer-container','/footer.html');
  
    const map = L.map('weather-map', { center:[20,0], zoom:2 });
    const base = L.tileLayer(
      'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
      { attribution:'&copy; CartoDB &mdash; &copy; OpenStreetMap' }
    ).addTo(map);
  
    map.on('moveend', () => map.invalidateSize());
    
    map.on('click', async (e) => {
      try {
        const { lat, lng } = e.latlng;
        const res  = await fetch(
          `https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}` +
          `&q=${lat},${lng}`
        );
        const data = await res.json();
        L.popup()
         .setLatLng(e.latlng)
         .setContent(`
           <strong>${data.location.name}</strong><br>
           ${Math.round(data.current.temp_c)}°C, ${data.current.condition.text}
         `)
         .openOn(map);
      } catch (err) {
        console.error('Map weather error', err);
      }
    });
  });
  </script>  
</body>
</html>
